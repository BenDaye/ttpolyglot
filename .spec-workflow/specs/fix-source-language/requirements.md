# 修复源语言设计问题 - Requirements Document

## Introduction

当前项目的翻译管理系统采用了"源语言 + 目标语言列表"的设计模式，其中源语言是可修改的。这种设计存在严重的数据一致性和业务逻辑复杂性问题。本次功能开发旨在修复这一设计缺陷，采用固定主语言的方案来提高系统的稳定性和可维护性。

## Alignment with Product Vision

本功能修复直接支持产品愿景中的以下目标：
- **提升Flutter应用的多语言开发效率**：通过简化源语言管理减少开发复杂性
- **降低国际化开发的复杂度**：消除源语言修改带来的连锁反应
- **提供标准化的翻译管理流程**：建立更清晰稳定的翻译管理模式
- **支持大型项目的翻译协作需求**：减少数据一致性问题对团队协作的影响

## Requirements

### Requirement 1: 固定主语言设计

**User Story:** 作为一个项目管理员，我希望在创建项目时设置固定不变的主语言，这样可以避免后续修改源语言带来的数据一致性问题。

#### Acceptance Criteria

1. WHEN 用户创建新项目 THEN 系统 SHALL 要求用户选择一个主语言，该语言将在项目生命周期内保持不变
2. WHEN 项目创建完成后 THEN 系统 SHALL 禁止修改项目的主语言
3. IF 用户尝试修改主语言 THEN 系统 SHALL 显示明确的错误提示并阻止操作
4. WHEN 项目已存在翻译条目 THEN 系统 SHALL 验证所有翻译条目的源语言与项目主语言一致

### Requirement 2: 移除源语言修改功能

**User Story:** 作为一个开发者，我希望移除所有允许修改源语言的UI和API，这样可以防止意外的数据不一致问题。

#### Acceptance Criteria

1. WHEN 用户查看项目设置 THEN 系统 SHALL 不显示任何修改源语言的选项
2. WHEN 开发者调用项目更新API THEN 系统 SHALL 忽略任何试图修改主语言的请求
3. IF 代码中存在修改源语言的逻辑 THEN 系统 SHALL 在编译时或运行时阻止此类操作
4. WHEN 项目初始化 THEN 系统 SHALL 确保所有翻译条目使用正确的固定主语言

### Requirement 3: 数据一致性保证

**User Story:** 作为一个系统管理员，我希望确保所有翻译数据都使用正确的固定主语言，这样可以维护数据的一致性和完整性。

#### Acceptance Criteria

1. WHEN 系统加载项目数据 THEN 系统 SHALL 验证所有翻译条目的源语言与项目主语言匹配
2. IF 发现源语言不匹配的翻译条目 THEN 系统 SHALL 自动修复或标记为需要审核
3. WHEN 创建新的翻译条目 THEN 系统 SHALL 强制使用项目的主语言作为源语言
4. WHEN 导入翻译数据 THEN 系统 SHALL 验证源语言的一致性并在不匹配时给出明确提示

## Non-Functional Requirements

### Code Architecture and Modularity
- **Single Responsibility Principle**: 确保项目管理相关的每个类只负责单一职责
- **Modular Design**: 将源语言验证逻辑封装为独立的模块，便于测试和维护
- **Dependency Management**: 减少项目控制器与其他模块的耦合度
- **Clear Interfaces**: 定义清晰的项目配置接口，避免直接暴露内部状态

### Performance
- **数据加载时间**: 项目数据验证不应增加超过10%的加载时间
- **内存使用**: 源语言验证逻辑不应显著增加内存消耗
- **响应时间**: 项目创建和更新的响应时间保持在原有水平

### Security
- **数据完整性**: 确保源语言修改被完全阻止，避免数据污染
- **访问控制**: 保持原有的权限控制机制不变

### Reliability
- **错误处理**: 提供清晰的错误信息，当数据不一致时能准确定位问题
- **数据恢复**: 在发现不一致数据时提供自动修复或手动修复的选项
- **日志记录**: 记录所有源语言相关的验证和修复操作

### Usability
- **用户反馈**: 在项目创建时提供清晰的指导，说明主语言的重要性
- **错误提示**: 当发现数据不一致时提供友好的错误提示和修复建议
- **向后兼容**: 确保现有项目的迁移过程平滑无损